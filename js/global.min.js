function updateClock(){var e=new Date,t=new Array(7);t[0]="Söndag",t[1]="Måndag",t[2]="Tisdag",t[3]="Onsdag",t[4]="Torsdag",t[5]="Fredag",t[6]="Lördag",$("#currenttime").html(getTime(e)),$("#currentday").html(t[e.getDay()]),$("#currentdate").html(e.toLocaleDateString("sv-SE")),$(".traffic-result").each(function(){var t=$(this).children(".traffic-third").children(".departure-time").attr("data-date"),i=new Date(t);e>=i&&$(this).animate({bottom:"0px",opacity:.25,height:"toggle",padding:"0px",margin:"0px"},1500,"easeInQuart",function(){$(this).remove()})});var i=$("#traffic-results").children(".traffic-result").length;2>i&&!currentlyUpdatingTraffic&&(currentlyUpdatingTraffic=!0,debugLog("Too few departures, getting departures"),getDepartures());var n=Math.round((e-trafficLastUpdated)/6e3);n>=20&&!currentlyUpdatingTraffic&&(debugLog("It has been way too long since traffic was updated"),debugLog(n),getDepartures())}function getDepartures(){var e=Cookies.get("traffic-toggle");if("false"==e)return void debugLog("Trying to update weather but the toggle is not checked");currentlyUpdatingTraffic=!0,newNotification("Uppdaterar trafik","info");var t="Åmänningevägen",i=7453026,n=document.querySelector("#station-menu").selected,o=n.substring(n.length-7,n.length),a=n.substring(0,n.length-8),r=t,s=i;(void 0!==o||""!==o||null!==o||void 0!==a||""!==a||null!==a)&&(s=o,r=a),$("#traffic-search-input").html(r),debugLog("Getting departures for: "+r+" id: "+s),$("#traffic-loading").show(),$("#traffic-results").html(""),$.ajax({url:"php/publicTransport.php",data:{"function":"fullHTML",stationid:s},cache:!1,datatype:"html",success:function(e){$("#traffic-loading").hide(),$("#traffic-results").html(e),regexContainsErrorText.test(e)?(newNotification("Fel vid uppdatering av trafik","error",1e4),currentlyUpdatingTraffic=!0):(newNotification("Trafik uppdaterad","success"),currentlyUpdatingTraffic=!1),trafficLastUpdated=new Date,trafficLastUpdatedSwedishFormat=getTime(trafficLastUpdated,"swedish-full"),$("#traffic-last-updated").html("Senast uppdaterad: "+trafficLastUpdatedSwedishFormat)}})}function getWeather(){var e=Cookies.get("weather-toggle");if("false"==e)return void debugLog("Trying to update weather but the toggle is not checked");newNotification("Uppdaterar vädret","info"),$("#weather-loading").show(),$(".weather-item-container").hide();var t=document.querySelector("#latitude-input"),i=document.querySelector("#longitude-input"),n=document.querySelector("#timezone-input"),o=t.value,a=i.value,r=n.value;t.validate()&&i.validate()||console.log("its truuu"),$.ajax({url:"php/weather.php",data:{htmlCall:"true",debug:debugSetting,lat:o,lon:a,timezone:r},cache:!1,datatype:"html",success:function(e){$("#weather-loading").hide(),$("#weather-data").html(e),regexContainsErrorText.test(e)?newNotification("Fel vid hämtning av väder","error",1e4):newNotification("Vädret uppdaterat","success");var t=new Date;$("#weather-last-updated").html("Senast uppdaterad: "+getTime(t,"swedish-full"))}})}function getStocks(){var e=Cookies.get("stocks-toggle");if("false"==e)return void debugLog("Trying to update weather but the toggle is not checked");newNotification("Uppdaterar aktier","info"),$(".stock-items").html(""),$("#stocks-loading").show();var t=$("#stocks-input").val(),i=""!==t?t:"AAPL,FB,GOOG,TSLA,MSFT",n=/^([a-zA-Z]{2,8}){1}(,[a-zA-Z]{2,8})*$/;return n.test(i)?void $.ajax({url:"php/stocks.php",data:{"function":"html",debug:"false",stocks:i},cache:!1,datatype:"html",success:function(e){$("#stocks-loading").hide(),$(".stock-items").html(e),regexContainsErrorText.test(e)?newNotification("Fel vid hämtning av aktier","error",1e4):newNotification("Aktier uppdaterade","success");var t=new Date;$("#stocks-last-updated").html("Senast uppdaterad: "+getTime(t,"swedish-full"))}}):void newNotification("Felaktig inmatning av aktier","error",1e4)}function newNotification(e,t,i){var n=$("#notifications-toggle").attr("checked");if("undefined"!=typeof n&&n!==!1){var t="undefined"!=typeof t?t:"info",i="undefined"!=typeof i?i:5e3,o={notification:"bell",info:"info",success:"check",error:"ban",warning:"exclamation-triangle"};for(o.length in o)if(o.hasOwnProperty(t))var a=o[t];$(".notifications-container").append("<div class='notification "+t+"'>          <div class='remove-notification icon icon-times'></div>          <div class='notification-data'>              <div class='notification-icon icon icon-"+a+"'></div>              <div class='notification-text'>"+e+"</div>          </div>        </div>").children(".notification").delay(i).fadeOut(1500,function(){$(this).remove()})}}function getTime(e,t){t="undefined"!=typeof t?t:"none";var i=e.getDate(),n=e.getMonth()+1,o=e.getFullYear(),a=e.getHours(),r=e.getMinutes(),s=e.getSeconds();return 10>s&&(s="0"+s),10>r&&(r="0"+r),10>a&&(a="0"+a),10>i&&(i="0"+i),10>n&&(n="0"+n),"swedish-full"==t?o+"-"+n+"-"+i+" "+a+":"+r+":"+s:a+":"+r+":"+s}function setSettingsFromCookies(){var e=Cookies.get("notifcations");"undefined"!=typeof e&&e!==!1&&"checked"==e&&$("#notifications-toggle").prop("active",!0);var t=Cookies.get("debug");"undefined"!=typeof t&&t!==!1&&"false"!==t&&$("#debug-toggle").prop("active",!0);var i,n=Cookies.get("stocks-input"),o=Cookies.get("numberofdepartures-input"),a=Cookies.get("station-input"),r=Cookies.get("latitude-input"),s=Cookies.get("longitude-input"),c=Cookies.get("timezone-input"),g=Cookies.get("time-toggle"),d=Cookies.get("weather-toggle"),u=Cookies.get("traffic-toggle"),l=Cookies.get("stocks-toggle"),f=Cookies.get("lights-toggle"),h={"stocks-input":n,"numberofdepartures-input":o,"latitude-input":r,"longitude-input":s,"timezone-input":c,"time-toggle":g,"weather-toggle":d,"traffic-toggle":u,"stocks-toggle":l,"lights-toggle":f};for(var p in h)h.hasOwnProperty(p)&&(i=h[p],"undefined"!=typeof i&&i!==!1&&null!==i&&""!==i&&(p.indexOf("-input")>-1&&(document.getElementById(p).value=i),p.indexOf("-toggle")>-1&&"false"==i&&document.getElementById(p).click()));var m=document.querySelector("#station-menu");if("undefined"!=typeof a&&a!==!1&&null!==a){if(m.selected==a)return;m.select(a)}}function gpsSuccess(e){var t=e.coords.longitude,i=e.coords.latitude;document.getElementById("longitude-input").value=t,Cookies.set("longitude-input",t),document.getElementById("latitude-input").value=i,Cookies.set("latitude-input",i),getWeather()}function gpsFail(){newNotification("Kunde inte hämta koordinater. Tillåter din webbläsare 'navigator.geolocation*'?","error",1e4)}function debugLog(e){debugSetting===!0&&console.log(e)}function showSavingSettings(e){debugLog("showing settings savings card"),clearTimeout(savingSettingsTimer),clearTimeout(settingsCompleteTimer);var t=$("#saving-settings-card");if(t.removeClass("hidden"),$("#saving-settings-icon-success").hide(),$("#saving-settings-icon-error").hide(),$("#saving-settings-spinner").show(),$("#saving-settings-text").html("Sparar inställningar"),"undefined"!=typeof e&&""!==e)var i=e.val(),n=e.attr("id"),o=(n.substring(0,n.length-6),document.querySelector("#"+n).validate());else o=!0;savingSettingsTimer=setTimeout(function(){o?("undefined"!=typeof i&&(Cookies.set(n,i),debugLog("Cookie: "+n+" val:"+i)),"stocks-input"==n&&getStocks(),$("#saving-settings-spinner").hide(),$("#saving-settings-icon-success").show(),settingsCompleteTimer=setTimeout(function(){t.addClass("hidden")},2e3)):($("#saving-settings-spinner").hide(),$("#saving-settings-icon-error").show(),$("#saving-settings-text").html("Felaktig inmatning"))},1e3)}var startTime=new Date,regexContainsErrorText=/\b[Ee][Rr][Rr][Oo][Rr]\b/,debugSetting="true"===Cookies.get("debug"),savingSettingsTimer,settingsCompleteTimer,currentlyUpdatingTraffic=!0,trafficLastUpdated,trafficLastUpdatedSwedishFormat;$(document).ready(function(){var e=new Date-startTime;debugLog("document.ready: "+e+" ms");var t=new Slideout({panel:document.getElementById("panel"),menu:document.getElementById("slide-menu"),padding:260,tolerance:70});document.querySelector(".slideout-toggle-button").addEventListener("click",function(){t.toggle()}),debugSetting&&t.open(),$("#auto-gps-button").click(function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(gpsSuccess,gpsFail):newNotification("Tyvärr så stödjer inte din webbläsare geo location","error")}),window.addEventListener("WebComponentsReady",function(){setSettingsFromCookies();var e=new Date-startTime;debugLog("polymer ready: "+e+" ms"),updateClock(),setInterval("updateClock()",1e3),getDepartures(),getWeather(),setInterval("getWeather()",18e5),getStocks(),setInterval("getStocks()",18e5);var t=new Date-startTime;debugLog("everything completed: "+t+" ms")}),$(".lights-purple").click(function(){$(this).toggleClass("active");var e=$(this).attr("data-channel"),t=$(this).hasClass("active")?"1":"0";$.ajax({url:"php/lights.php",data:{"function":"toggleLight",debug:"true",channel:e,state:t},cache:!1,datatype:"html",success:function(e){debugLog(e),regexContainsErrorText.test(e)?newNotification("Fel vid ändring av belysning","error",1e4):newNotification("Belysning uppdaterad","success")}})}),$(".lights-all").click(function(){var e=$(this).attr("id").substring(4,this.length),t="off"==e?"0":"1";debugLog(e+" "+t),"off"==e?$(".lights-purple").removeClass("active"):($(".lights-purple").removeClass("active"),$(".lights-purple").addClass("active")),$.ajax({url:"php/lights.php",data:{"function":"toggleAllLights",debug:"true",state:t},cache:!1,datatype:"html",success:function(e){debugLog(e),regexContainsErrorText.test(e)?newNotification("Fel vid ändring av all belysning","error",1e4):newNotification("Belysning uppdaterad","success")}})}),$(".column-content").on({mouseenter:function(){$("#refresh-traffic").addClass("icon-spin")},mouseleave:function(){$("#refresh-traffic").removeClass("icon-spin")},click:function(){getDepartures()}},"#refresh-traffic");var i=$(".notifications-container");i.on({mouseleave:function(){$(this).children(".notification").fadeOut(3e3,function(){$(this).remove()})},mouseenter:function(){$(this).children(".notification").stop(!0,!1).fadeIn(500)}}),i.on({click:function(){$(this).parent(".notification").animate({opacity:0},500,"easeInQuart",function(){$(this).remove()})}},".remove-notification");var n=document.querySelector("#notifications-toggle");n.addEventListener("change",function(){this.checked?Cookies.set("notifcations","checked"):Cookies.set("notifcations","unchecked")});var o=document.querySelector("#debug-toggle");o.addEventListener("change",function(){this.checked?(debugSetting=!0,Cookies.set("debug","true")):(debugSetting=!1,Cookies.set("debug","false"))});var a=document.querySelector("#station-menu");a.addEventListener("iron-select",function(){showSavingSettings(),Cookies.set("station-input",a.selected),currentlyUpdatingTraffic=!0,getDepartures()}),$(".settings-input").on("keyup",function(){showSavingSettings($(this))}),$("#traffic-results").on({click:function(){$(this).find(".traffic-second").toggle(),$(this).find(".traffic-third").toggle(),$(this).find(".traffic-stops").toggle()}},".traffic-result"),$(".module-toggle").on("click",function(){showSavingSettings();var e=$(this).attr("id"),t=e.substr(0,e.length-7),i=$(this).attr("aria-checked");debugLog("Clicked id: "+t+" checked: "+i);var n=document.querySelector("#time-toggle"),o=document.querySelector("#weather-toggle"),a=document.querySelector("#traffic-toggle"),r=document.querySelector("#stocks-toggle"),s=document.querySelector("#lights-toggle"),c=$("#column-1"),g=$("#column-2"),d=$("#column-3");$("#"+t).toggle(),Cookies.set(t+"-toggle",i),"true"==i&&("weather"==t&&getWeather(),"traffic"==t&&getDepartures(),"stocks"==t&&getStocks()),n.checked||o.checked?d.show():d.hide(),a.checked?g.show():g.hide(),r.checked||s.checked?c.show():c.hide()})});