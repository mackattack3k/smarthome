function updateClock(){var e=new Date,t=new Array(7);t[0]="Söndag",t[1]="Måndag",t[2]="Tisdag",t[3]="Onsdag",t[4]="Torsdag",t[5]="Fredag",t[6]="Lördag",$("#currenttime").html(getTime(e)),$("#currentday").html(t[e.getDay()]),$("#currentdate").html(e.toLocaleDateString("sv-SE")),$(".traffic-result").each(function(){var t=$(this).children(".traffic-third").children(".departure-time").attr("data-date"),i=new Date(t);e>=i&&$(this).animate({bottom:"0px",opacity:.25,height:"toggle",padding:"0px",margin:"0px"},1500,"easeInQuart",function(){$(this).remove()})});var i=$("#traffic-results").children(".traffic-result").length;2>i&&!currentlyUpdatingTraffic&&(currentlyUpdatingTraffic=!0,debugLog("Too few departures, getting departures"),getDepartures())}function getDepartures(){newNotification("Updating public transport","info");var e="Åmänningevägen",t=7453026,i=document.querySelector("#station-menu").selected,n=i.substring(i.length-7,i.length),o=i.substring(0,i.length-8),a=e,s=t;(void 0!==n||""!==n||null!==n||void 0!==o||""!==o||null!==o)&&(s=n,a=o),$("#traffic-search-input").html(a),debugLog("Getting departures for: "+a+" id: "+s),$("#traffic-loading").addClass("traffic-loading-before").removeClass("traffic-loading-no-before").show(),$("#traffic-results").html(""),$.ajax({url:"php/publicTransport.php",data:{"function":"fullHTML",stationid:s},cache:!1,datatype:"html",success:function(e){$("#traffic-loading").addClass("traffic-loading-no-before").removeClass("traffic-loading-before").hide(),$("#traffic-results").html(e),regexContainsErrorText.test(e)?(newNotification("Error updating public transport","error",1e4),currentlyUpdatingTraffic=!0):(newNotification("Public transport updated","success"),currentlyUpdatingTraffic=!1);var t=new Date;$("#traffic-last-updated").html("Senast uppdaterad: "+getTime(t,"swedish-full"))}})}function getWeather(){newNotification("Updating weather","info"),$("#weather-loading").addClass("weather-loading-before").removeClass(".weather-loading-no-before").css("margin","20px"),$(".weather-item-container").hide();var e=Cookies.get("latitude-input"),t=Cookies.get("longitude-input");$.ajax({url:"php/weather.php",data:{htmlCall:"true",debug:debugSetting,lat:e,lon:t},cache:!1,datatype:"html",success:function(e){$("#weather-loading").addClass("weather-loading-no-before").removeClass(".weather-loading-before").css("margin","0px"),$("#weather-data").html(e),regexContainsErrorText.test(e)?newNotification("Error getting weather","error",1e4):newNotification("Weather updated","success");var t=new Date;$("#weather-last-updated").html("Senast uppdaterad: "+getTime(t,"swedish-full"))}})}function getStocks(){newNotification("Updating weather","info"),$("#stocks-loading").addClass("weather-loading-before").removeClass(".weather-loading-no-before").css("margin","20px"),$.ajax({url:"php/stocks.php",data:{"function":"html",debug:"false",stocks:"AAPL,FB,GOOG,TSLA,MSFT"},cache:!1,datatype:"html",success:function(e){$("#stocks-loading").addClass("weather-loading-no-before").removeClass(".weather-loading-before").css("margin","0px"),$(".stock-items").html(e),regexContainsErrorText.test(e)?newNotification("Error getting stocks","error",1e4):newNotification("Stocks updated","success");var t=new Date;$("#stocks-last-updated").html("Senast uppdaterad: "+getTime(t,"swedish-full"))}})}function newNotification(e,t,i){var n=$("#notifications-toggle").attr("checked");if("undefined"!=typeof n&&n!==!1){var t="undefined"!=typeof t?t:"info",i="undefined"!=typeof i?i:5e3,o={notification:"bell",info:"info",success:"check",error:"ban",warning:"exclamation-triangle"};for(o.length in o)if(o.hasOwnProperty(t))var a=o[t];$(".notifications-container").append("<div class='notification "+t+"'>          <div class='remove-notification icon icon-times'></div>          <div class='notification-data'>              <div class='notification-icon icon icon-"+a+"'></div>              <div class='notification-text'>"+e+"</div>          </div>        </div>").children(".notification").delay(i).fadeOut(1500,function(){$(this).remove()})}}function getTime(e,t){t="undefined"!=typeof t?t:"none";var i=e.getDate(),n=e.getMonth()+1,o=e.getFullYear(),a=e.getHours(),s=e.getMinutes(),r=e.getSeconds();return 10>r&&(r="0"+r),10>s&&(s="0"+s),10>a&&(a="0"+a),10>i&&(i="0"+i),10>n&&(n="0"+n),"swedish-full"==t?o+"-"+n+"-"+i+" "+a+":"+s+":"+r:a+":"+s+":"+r}function setSettingsFromCookies(){var e=Cookies.get("notifcations");"undefined"!=typeof e&&e!==!1&&"checked"==e&&debugLog($("#notifications-toggle"));var t,i=Cookies.get("stocks-input"),n=Cookies.get("numberofdepartures-input"),o=Cookies.get("station-input"),a=Cookies.get("latitude-input"),s=Cookies.get("longitude-input"),r=Cookies.get("timezone-input"),c={"stocks-input":i,"numberofdepartures-input":n,"latitude-input":a,"longitude-input":s,"timezone-input":r};for(var u in c)c.hasOwnProperty(u)&&(t=c[u],"undefined"!=typeof t&&t!==!1&&null!==t&&""!==t&&(document.getElementById(u).value=t));var d=document.querySelector("#station-menu");if("undefined"!=typeof o&&o!==!1&&null!==o){if(d.selected==o)return;d.select(o)}}function gpsSuccess(e){var t=e.coords.longitude,i=e.coords.latitude;document.getElementById("longitude-input").value=t,Cookies.set("longitude-input",t),document.getElementById("latitude-input").value=i,Cookies.set("latitude-input",i)}function gpsFail(){newNotification("Could not get coordinates. Is your browser allowing 'navigator.geolocation*'?","error",1e4)}function debugLog(e){debugSetting===!0&&console.log(e)}function showSavingSettings(e){if(clearTimeout(savingSettingsTimer),clearTimeout(settingsCompleteTimer),$("#saving-settings-card").stop().fadeTo(0,100),$("#saving-settings-icon-success").hide(),$("#saving-settings-icon-error").hide(),$("#saving-settings-spinner").show(),$("#saving-settings-text").html("Sparar inställningar"),"undefined"!=typeof e&&""!==e)var t=e.val(),i=e.attr("id"),n=(i.substring(0,i.length-6),document.querySelector("#"+i).validate());else n=!0;$("#saving-settings-card").css({display:"-webkit-box",display:"-webkit-flex",display:"-moz-flex",display:"-ms-flexbox",display:"flex"}),savingSettingsTimer=setTimeout(function(){n?("undefined"!=typeof t&&(Cookies.set(i,t),debugLog("Cookie: "+i+" val:"+t)),$("#saving-settings-spinner").hide(),$("#saving-settings-icon-success").show(),settingsCompleteTimer=setTimeout(function(){$("#saving-settings-card").fadeOut(1500)},2e3)):($("#saving-settings-spinner").hide(),$("#saving-settings-icon-error").show(),$("#saving-settings-text").html("Felaktig inmatning"))},1e3)}var currentlyUpdatingTraffic=!0,regexContainsErrorText=/\b[Ee][Rr][Rr][Oo][Rr]\b/,debugSetting=!1,savingSettingsTimer,settingsCompleteTimer;$(document).ready(function(){var e=new Slideout({panel:document.getElementById("panel"),menu:document.getElementById("slide-menu"),padding:260,tolerance:70});document.querySelector(".slideout-toggle-button").addEventListener("click",function(){e.toggle()}),$("#auto-gps-button").click(function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(gpsSuccess,gpsFail):newNotification("Sorry, your browser does not support geolocation services.","error"),getWeather()}),setSettingsFromCookies(),updateClock(),setInterval("updateClock()",1e3),getDepartures(),getWeather(),setInterval("getWeather()",18e5),getStocks(),setInterval("getStocks()",18e5),$(".lights-purple").click(function(){$(this).toggleClass("active");var e=$(this).attr("data-channel"),t=$(this).hasClass("active")?"1":"0";$.ajax({url:"php/lights.php",data:{"function":"toggleLight",debug:"true",channel:e,state:t},cache:!1,datatype:"html",success:function(e){debugLog(e),regexContainsErrorText.test(e)?newNotification("Error setting light","error",1e4):newNotification("Lights updated","success")}})}),$(".lights-all").click(function(){var e=$(this).attr("id").substring(4,this.length),t="off"==e?"0":"1";debugLog(e+" "+t),"off"==e?$(".lights-purple").removeClass("active"):($(".lights-purple").removeClass("active"),$(".lights-purple").addClass("active")),$.ajax({url:"php/lights.php",data:{"function":"toggleAllLights",debug:"true",state:t},cache:!1,datatype:"html",success:function(e){debugLog(e),regexContainsErrorText.test(e)?newNotification("Error setting  all lights","error",1e4):newNotification("Lights updated","success")}})}),$(".column-content").on({mouseenter:function(){$("#refresh-traffic").addClass("icon-spin")},mouseleave:function(){$("#refresh-traffic").removeClass("icon-spin")},click:function(){getDepartures()}},"#refresh-traffic");var t=$(".notifications-container");t.on({mouseleave:function(){$(this).children(".notification").fadeOut(3e3,function(){$(this).remove()})},mouseenter:function(){$(this).children(".notification").stop(!0,!1).fadeIn(500)}}),t.on({click:function(){$(this).parent(".notification").animate({opacity:0},500,"easeInQuart",function(){$(this).remove()})}},".remove-notification");var i=document.querySelector("#notifications-toggle");i.addEventListener("change",function(){this.checked?Cookies.set("notifcations","checked"):Cookies.set("notifcations","unchecked")});var n=document.querySelector("#debug-toggle");n.addEventListener("change",function(){this.checked?(debugSetting=!0,Cookies.set("debug","on")):(debugSetting=!1,Cookies.set("debug","off"))});var o=document.querySelector("#station-menu");o.addEventListener("iron-select",function(){showSavingSettings(),Cookies.set("station-input",o.selected),currentlyUpdatingTraffic=!0,getDepartures()}),$(".settings-input").on("input",function(){showSavingSettings($(this))})});