function updateClock(){var t=new Date,e=new Array(7);e[0]="Söndag",e[1]="Måndag",e[2]="Tisdag",e[3]="Onsdag",e[4]="Torsdag",e[5]="Fredag",e[6]="Lördag",$("#currenttime").html(getTime(t)),$("#currentday").html(e[t.getDay()]),$("#currentdate").html(t.toLocaleDateString("sv-SE")),$(".traffic-result").each(function(){var e=$(this).children(".traffic-third").children(".departure-time").attr("value"),i=new Date(e);t>=i&&$(this).animate({bottom:"0px",opacity:.25,height:"toggle",padding:"0px",margin:"0px"},1500,"easeInQuart",function(){$(this).remove()})});var i=$("#traffic-results").children(".traffic-result").length;2>i&&!currentlyUpdatingTraffic&&(currentlyUpdatingTraffic=!0,console.log("Too few departures, getting departures"),getDepartures())}function getDepartures(){newNotification("Updating public transport","info");var t=$("#traffic-search-input").val(),e=7453026;console.log("Getting departures for: "+t+" id: "+e),$("#traffic-loading").addClass("traffic-loading-before").removeClass("traffic-loading-no-before").show(),$("#traffic-results").html(""),$.ajax({url:"php/publicTransport.php",data:{"function":"fullHTML",stationid:e},cache:!1,datatype:"html",success:function(t){$("#traffic-loading").addClass("traffic-loading-no-before").removeClass("traffic-loading-before").hide(),$("#traffic-results").html(t),regexContainsErrorText.test(t)?(newNotification("Error updating public transport","error",1e4),currentlyUpdatingTraffic=!0):(newNotification("Public transport updated","success"),currentlyUpdatingTraffic=!1);var e=new Date;$("#traffic-last-updated").html("Senast uppdaterad: "+getTime(e,"swedish-full"))}})}function getWeather(){newNotification("Updating weather","info"),$("#weather-loading").addClass("weather-loading-before").removeClass(".weather-loading-no-before").css("margin","20px"),$(".weather-item-container").hide(),$.ajax({url:"php/weather.php",data:{htmlCall:"true",debug:"false"},cache:!1,datatype:"html",success:function(t){$("#weather-loading").addClass("weather-loading-no-before").removeClass(".weather-loading-before").css("margin","0px"),$("#weather-data").html(t),regexContainsErrorText.test(t)?newNotification("Error getting weather","error",1e4):newNotification("Weather updated","success");var e=new Date;$("#weather-last-updated").html("Senast uppdaterad: "+getTime(e,"swedish-full"))}})}function getStocks(){newNotification("Updating weather","info"),$("#stocks-loading").addClass("weather-loading-before").removeClass(".weather-loading-no-before").css("margin","20px"),$.ajax({url:"php/stocks.php",data:{"function":"html",debug:"false",stocks:"AAPL,FB,GOOG,TSLA,MSFT"},cache:!1,datatype:"html",success:function(t){$("#stocks-loading").addClass("weather-loading-no-before").removeClass(".weather-loading-before").css("margin","0px"),$(".stock-items").html(t),regexContainsErrorText.test(t)?newNotification("Error getting stocks","error",1e4):newNotification("Stocks updated","success");var e=new Date;$("#stocks-last-updated").html("Senast uppdaterad: "+getTime(e,"swedish-full"))}})}function newNotification(t,e,i){var a=$("#notifications-toggle").attr("checked");if("undefined"!=typeof a&&a!==!1){var e="undefined"!=typeof e?e:"info",i="undefined"!=typeof i?i:5e3,n={notification:"bell",info:"info",success:"check",error:"ban",warning:"exclamation-triangle"};for(n.length in n)if(n.hasOwnProperty(e))var o=n[e];$(".notifications-container").append("<div class='notification "+e+"'>          <div class='remove-notification icon icon-times'></div>          <div class='notification-data'>              <div class='notification-icon icon icon-"+o+"'></div>              <div class='notification-text'>"+t+"</div>          </div>        </div>").children(".notification").delay(i).fadeOut(1500,function(){$(this).remove()})}}function getTime(t,e){e="undefined"!=typeof e?e:"none";var i=t.getDate(),a=t.getMonth()+1,n=t.getFullYear(),o=t.getHours(),r=t.getMinutes(),s=t.getSeconds();return 10>s&&(s="0"+s),10>r&&(r="0"+r),10>o&&(o="0"+o),"swedish-full"==e?n+"-"+a+"-"+i+" "+o+":"+r+":"+s:o+":"+r+":"+s}function setSettingsFromCookies(){var t=Cookies.get("notifcations");"undefined"!=typeof t&&t!==!1&&"unchecked"==t&&console.log("wwaaat"),$("#notifications-toggle").trigger("click")}var currentlyUpdatingTraffic=!0,regexContainsErrorText=/\b[Ee][Rr][Rr][Oo][Rr]\b/;$(document).ready(function(){setSettingsFromCookies(),updateClock(),setInterval("updateClock()",1e3),getDepartures(),getWeather(),setInterval("getWeather()",18e5),getStocks(),setInterval("getStocks()",18e5),$(".lights-purple").click(function(){$(this).toggleClass("active");var t=$(this).attr("data-channel"),e=$(this).hasClass("active")?"1":"0";$.ajax({url:"php/lights.php",data:{"function":"toggleLight",debug:"true",channel:t,state:e},cache:!1,datatype:"html",success:function(t){console.log(t),regexContainsErrorText.test(t)?newNotification("Error setting light","error",1e4):newNotification("Lights updated","success")}})}),$(".lights-all").click(function(){var t=$(this).attr("id").substring(4,this.length),e="off"==t?"0":"1";console.log(t+" "+e),"off"==t?$(".lights-purple").removeClass("active"):($(".lights-purple").removeClass("active"),$(".lights-purple").addClass("active")),$.ajax({url:"php/lights.php",data:{"function":"toggleAllLights",debug:"true",state:e},cache:!1,datatype:"html",success:function(t){console.log(t),regexContainsErrorText.test(t)?newNotification("Error setting  all lights","error",1e4):newNotification("Lights updated","success")}})}),$(".column-content").on({mouseenter:function(){$("#refresh-traffic").addClass("icon-spin")},mouseleave:function(){$("#refresh-traffic").removeClass("icon-spin")},click:function(){getDepartures()}},"#refresh-traffic");var t=$(".notifications-container");t.on({mouseleave:function(){$(this).children(".notification").fadeOut(3e3,function(){$(this).remove()})},mouseenter:function(){$(this).children(".notification").stop(!0,!1).fadeIn(500)}}),t.on({click:function(){$(this).parent(".notification").animate({opacity:0},500,"easeInQuart",function(){$(this).remove()})}},".remove-notification");var e=document.querySelector("#notifications-toggle");e.addEventListener("change",function(){this.checked?Cookies.set("notifcations","checked"):Cookies.set("notifcations","unchecked")})});