function updateClock(){var e=new Date,t=new Array(7);t[0]="Söndag",t[1]="Måndag",t[2]="Tisdag",t[3]="Onsdag",t[4]="Torsdag",t[5]="Fredag",t[6]="Lördag",$("#currenttime").html(getTime(e)),$("#currentday").html(t[e.getDay()]),$("#currentdate").html(e.toLocaleDateString("sv-SE")),$(".traffic-result").each(function(){var t=$(this).children(".traffic-third").children(".departure-time").attr("value"),i=new Date(t);e>=i&&$(this).animate({bottom:"0px",opacity:.25,height:"toggle",padding:"0px",margin:"0px"},1500,"easeInQuart",function(){$(this).remove()})}),$("#traffic-results").children(".traffic-result").length<=2&&$("#traffic-results").children(".traffic-result").length>=0&&!currentlyUpdatingTrafic&&(currentlyUpdatingTrafic=!0,getDeparture(),newNotification("Too few departure departures. <br/>Getting new ones"))}function getDepartures(){newNotification("Fetching the departures");var e=$("#traffic-search-input").val();if(""==e);else;console.log(e),$("#traffic-loading").addClass("traffic-loading-before"),$("#traffic-loading").removeClass("traffic-loading-no-before"),$("#traffic-loading").show(),$("#traffic-results").html(""),$.ajax({url:"functions.php?function=getDepartures&var1="+e,cache:!1}).done(function(e){$("#traffic-loading").addClass("traffic-loading-no-before"),$("#traffic-loading").removeClass("traffic-loading-before"),$("#traffic-loading").hide(),newNotification("New departures added"),$("#traffic-results").html(e),currentlyUpdatingTrafic=!1})}function getWeather(){newNotification("Fetching the weather"),$("#weather-loading").addClass("weather-loading-before").removeClass(".weather-loading-no-before").css("margin","20px"),$(".weather-item-container").hide();var e=["icon","desc","temp"],t={},i=0;$.each(e,function(){var a=e[i];$.ajax({url:"functions.php?function=getWeather&var1="+a,cache:!1,datatype:"html",success:function(i){t[a]=i,Object.keys(t).length==e.length&&($("#weather-loading").addClass("weather-loading-no-before").removeClass(".weather-loading-before").css("margin","0px"),$("#weather-current-icon").html(t.icon),$(".weather-current-details").empty().append(t.temp).append(t.desc),$(".weather-item-container").show(),newNotification("Weather updated"))}}),i++})}function newNotification(e){$(".notifications-container").append("<div class='notification'>      <div class='remove-notification icon icon-times'></div>      "+e+"    </div>    ").children(".notification").delay(5e3).fadeOut(1500,function(){$(this).remove()})}function getTime(e){var t=(e.getDate(),e.getMonth()+1,e.getFullYear(),e.getHours()),i=e.getMinutes(),a=e.getSeconds();return 10>a&&(a="0"+a),10>i&&(i="0"+i),10>t&&(t="0"+t),t+":"+i+":"+a}var currentlyUpdatingTrafic=!0;$(document).ready(function(){updateClock(),setInterval("updateClock()",1e3),getDepartures(),getWeather(),setInterval("getWeather()",18e5),$(".lights-yellow").click(function(){$(this).toggleClass("active");var e=$(this).attr("id"),t=$(this).hasClass("active")?"on":"off";$.ajax({url:"functions.php",data:{"function":"editLamps",var1:e,var2:t},type:"get",success:function(e){newNotification(e)}})}),$(".lights-all").click(function(){$(".lights-yellow").removeClass("active");var e=$(this).attr("id").substring(4,this.length);$.ajax({url:"functions.php",data:{"function":"editLamps",var1:"all",var2:e},type:"get",success:function(e){newNotification(e)}})}),$(".column-content").on({mouseenter:function(){$("#refresh-traffic").addClass("icon-spin")},mouseleave:function(){$("#refresh-traffic").removeClass("icon-spin")},click:function(){getDeparture()}},"#refresh-traffic"),$(".notifications-container").on({mouseenter:function(){$(this).children(".notification").stop(!0,!1).fadeIn(500)},mouseleave:function(){$(this).children(".notification").fadeOut(3e3,function(){$(this).remove()})}}),$(".notifications-container").on({click:function(){$(this).parent(".notification").animate({opacity:0},500,"easeInQuart",function(){$(this).remove()})}},".remove-notification")});