function updateClock(){var t=new Date,e=new Array(7);e[0]="Söndag",e[1]="Måndag",e[2]="Tisdag",e[3]="Onsdag",e[4]="Torsdag",e[5]="Fredag",e[6]="Lördag",$("#currenttime").html(getTime(t)),$("#currentday").html(e[t.getDay()]),$("#currentdate").html(t.toLocaleDateString("sv-SE")),$(".traffic-result").each(function(){var e=$(this).children(".traffic-third").children(".departure-time").attr("data-date"),i=new Date(e);t>=i&&$(this).animate({bottom:"0px",opacity:.25,height:"toggle",padding:"0px",margin:"0px"},1500,"easeInQuart",function(){$(this).remove()})});var i=$("#traffic-results").children(".traffic-result").length;2>i&&!currentlyUpdatingTraffic&&(currentlyUpdatingTraffic=!0,debugLog("Too few departures, getting departures"),getDepartures())}function getDepartures(){newNotification("Updating public transport","info");var t="Åmänningevägen",e=7453026,i=document.querySelector("#station-menu").selected,n=i.substring(i.length-7,i.length),o=i.substring(0,i.length-8),a=t,s=e;(void 0!==n||""!==n||null!==n||void 0!==o||""!==o||null!==o)&&(s=n,a=o),$("#traffic-search-input").html(a),debugLog("Getting departures for: "+a+" id: "+s),$("#traffic-loading").show(),$("#traffic-results").html(""),$.ajax({url:"php/publicTransport.php",data:{"function":"fullHTML",stationid:s},cache:!1,datatype:"html",success:function(t){$("#traffic-loading").hide(),$("#traffic-results").html(t),regexContainsErrorText.test(t)?(newNotification("Error updating public transport","error",1e4),currentlyUpdatingTraffic=!0):(newNotification("Public transport updated","success"),currentlyUpdatingTraffic=!1);var e=new Date;$("#traffic-last-updated").html("Senast uppdaterad: "+getTime(e,"swedish-full"))}})}function getWeather(){newNotification("Updating weather","info"),$("#weather-loading").show(),$(".weather-item-container").hide();var t=$("#latitude-input").val(),e=$("#longitude-input").val(),i=$("#timezone-input").val();$.ajax({url:"php/weather.php",data:{htmlCall:"true",debug:debugSetting,lat:t,lon:e,timezone:i},cache:!1,datatype:"html",success:function(t){$("#weather-loading").hide(),$("#weather-data").html(t),regexContainsErrorText.test(t)?newNotification("Error getting weather","error",1e4):newNotification("Weather updated","success");var e=new Date;$("#weather-last-updated").html("Senast uppdaterad: "+getTime(e,"swedish-full"))}})}function getStocks(){newNotification("Updating weather","info"),$("#stocks-loading").show();var t=$("#stocks-input").val(),e=""!==t?t:"AAPL,FB,GOOG,TSLA,MSFT";$.ajax({url:"php/stocks.php",data:{"function":"html",debug:"false",stocks:e},cache:!1,datatype:"html",success:function(t){$("#stocks-loading").hide(),$(".stock-items").html(t),regexContainsErrorText.test(t)?newNotification("Error getting stocks","error",1e4):newNotification("Stocks updated","success");var e=new Date;$("#stocks-last-updated").html("Senast uppdaterad: "+getTime(e,"swedish-full"))}})}function newNotification(t,e,i){var n=$("#notifications-toggle").attr("checked");if("undefined"!=typeof n&&n!==!1){var e="undefined"!=typeof e?e:"info",i="undefined"!=typeof i?i:5e3,o={notification:"bell",info:"info",success:"check",error:"ban",warning:"exclamation-triangle"};for(o.length in o)if(o.hasOwnProperty(e))var a=o[e];$(".notifications-container").append("<div class='notification "+e+"'>          <div class='remove-notification icon icon-times'></div>          <div class='notification-data'>              <div class='notification-icon icon icon-"+a+"'></div>              <div class='notification-text'>"+t+"</div>          </div>        </div>").children(".notification").delay(i).fadeOut(1500,function(){$(this).remove()})}}function getTime(t,e){e="undefined"!=typeof e?e:"none";var i=t.getDate(),n=t.getMonth()+1,o=t.getFullYear(),a=t.getHours(),s=t.getMinutes(),r=t.getSeconds();return 10>r&&(r="0"+r),10>s&&(s="0"+s),10>a&&(a="0"+a),10>i&&(i="0"+i),10>n&&(n="0"+n),"swedish-full"==e?o+"-"+n+"-"+i+" "+a+":"+s+":"+r:a+":"+s+":"+r}function setSettingsFromCookies(){var t=Cookies.get("notifcations");"undefined"!=typeof t&&t!==!1&&"checked"==t&&$("#notifications-toggle").prop("active",!0);var e=Cookies.get("debug");"undefined"!=typeof e&&e!==!1&&"false"!==e&&$("#debug-toggle").prop("active",!0);var i,n=Cookies.get("stocks-input"),o=Cookies.get("numberofdepartures-input"),a=Cookies.get("station-input"),s=Cookies.get("latitude-input"),r=Cookies.get("longitude-input"),c=Cookies.get("timezone-input"),u={"stocks-input":n,"numberofdepartures-input":o,"latitude-input":s,"longitude-input":r,"timezone-input":c};for(var g in u)u.hasOwnProperty(g)&&(i=u[g],"undefined"!=typeof i&&i!==!1&&null!==i&&""!==i&&(document.getElementById(g).value=i));var d=document.querySelector("#station-menu");if("undefined"!=typeof a&&a!==!1&&null!==a){if(d.selected==a)return;d.select(a)}}function gpsSuccess(t){var e=t.coords.longitude,i=t.coords.latitude;document.getElementById("longitude-input").value=e,Cookies.set("longitude-input",e),document.getElementById("latitude-input").value=i,Cookies.set("latitude-input",i),getWeather()}function gpsFail(){newNotification("Could not get coordinates. Is your browser allowing 'navigator.geolocation*'?","error",1e4)}function debugLog(t){debugSetting===!0&&console.log(t)}function showSavingSettings(t){debugLog("showing settings savings card"),clearTimeout(savingSettingsTimer),clearTimeout(settingsCompleteTimer);var e=$("#saving-settings-card");if(e.removeClass("hidden"),$("#saving-settings-icon-success").hide(),$("#saving-settings-icon-error").hide(),$("#saving-settings-spinner").show(),$("#saving-settings-text").html("Sparar inställningar"),"undefined"!=typeof t&&""!==t)var i=t.val(),n=t.attr("id"),o=(n.substring(0,n.length-6),document.querySelector("#"+n).validate());else o=!0;savingSettingsTimer=setTimeout(function(){o?("undefined"!=typeof i&&(Cookies.set(n,i),debugLog("Cookie: "+n+" val:"+i)),"stocks-input"==n&&getStocks(),$("#saving-settings-spinner").hide(),$("#saving-settings-icon-success").show(),settingsCompleteTimer=setTimeout(function(){e.addClass("hidden")},2e3)):($("#saving-settings-spinner").hide(),$("#saving-settings-icon-error").show(),$("#saving-settings-text").html("Felaktig inmatning"))},1e3)}var startTime=new Date,currentlyUpdatingTraffic=!0,regexContainsErrorText=/\b[Ee][Rr][Rr][Oo][Rr]\b/,debugSetting="true"===Cookies.get("debug"),savingSettingsTimer,settingsCompleteTimer;$(document).ready(function(){var t=new Date-startTime;debugLog("document.ready: "+t+" ms");var e=new Slideout({panel:document.getElementById("panel"),menu:document.getElementById("slide-menu"),padding:260,tolerance:70});document.querySelector(".slideout-toggle-button").addEventListener("click",function(){e.toggle()}),debugSetting&&e.open(),$("#auto-gps-button").click(function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(gpsSuccess,gpsFail):newNotification("Sorry, your browser does not support geolocation services.","error")}),window.addEventListener("WebComponentsReady",function(){setSettingsFromCookies();var t=new Date-startTime;debugLog("polymer ready: "+t+" ms"),updateClock(),setInterval("updateClock()",1e3),getDepartures(),getWeather(),setInterval("getWeather()",18e5),getStocks(),setInterval("getStocks()",18e5);var e=new Date-startTime;console.log("everything completed: "+e+" ms")}),$(".lights-purple").click(function(){$(this).toggleClass("active");var t=$(this).attr("data-channel"),e=$(this).hasClass("active")?"1":"0";$.ajax({url:"php/lights.php",data:{"function":"toggleLight",debug:"true",channel:t,state:e},cache:!1,datatype:"html",success:function(t){debugLog(t),regexContainsErrorText.test(t)?newNotification("Error setting light","error",1e4):newNotification("Lights updated","success")}})}),$(".lights-all").click(function(){var t=$(this).attr("id").substring(4,this.length),e="off"==t?"0":"1";debugLog(t+" "+e),"off"==t?$(".lights-purple").removeClass("active"):($(".lights-purple").removeClass("active"),$(".lights-purple").addClass("active")),$.ajax({url:"php/lights.php",data:{"function":"toggleAllLights",debug:"true",state:e},cache:!1,datatype:"html",success:function(t){debugLog(t),regexContainsErrorText.test(t)?newNotification("Error setting  all lights","error",1e4):newNotification("Lights updated","success")}})}),$(".column-content").on({mouseenter:function(){$("#refresh-traffic").addClass("icon-spin")},mouseleave:function(){$("#refresh-traffic").removeClass("icon-spin")},click:function(){getDepartures()}},"#refresh-traffic");var i=$(".notifications-container");i.on({mouseleave:function(){$(this).children(".notification").fadeOut(3e3,function(){$(this).remove()})},mouseenter:function(){$(this).children(".notification").stop(!0,!1).fadeIn(500)}}),i.on({click:function(){$(this).parent(".notification").animate({opacity:0},500,"easeInQuart",function(){$(this).remove()})}},".remove-notification");var n=document.querySelector("#notifications-toggle");n.addEventListener("change",function(){this.checked?Cookies.set("notifcations","checked"):Cookies.set("notifcations","unchecked")});var o=document.querySelector("#debug-toggle");o.addEventListener("change",function(){this.checked?(debugSetting=!0,Cookies.set("debug","true")):(debugSetting=!1,Cookies.set("debug","false"))});var a=document.querySelector("#station-menu");a.addEventListener("iron-select",function(){showSavingSettings(),Cookies.set("station-input",a.selected),currentlyUpdatingTraffic=!0,getDepartures()}),$(".settings-input").on("keyup",function(){showSavingSettings($(this))})});